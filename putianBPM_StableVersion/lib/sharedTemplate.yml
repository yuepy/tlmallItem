- name: askForLeaveList
  getTemplate: "import {Component} from \"react\";\nexport default class extends Component{\n  enclosure(e){\n    var target=e.target;\n    var handler=this.props.customHandler;\n    if(handler){\n      handler({\n        data:target.dataset.i,\n        eventType:\"enclosure\"\n      })\n    }\n  }\n  render(){\n    var data=this.props.customData||[];\n    var _this=this;\n    if(data&&data.topTitle&&data.topTitle!==\"\"){\n      return(\n        <div className=\"ysp_hrDetailInfo\" style={{marginTop:\"10px\"}}>\n          <div className=\"ysp_hrDetailInfo_title\">{data.topTitle}</div>\n          <div className=\"ysp_hrDetailInfo_content\">\n            {data.holidayDetail&&data.holidayDetail.length>0&&data.holidayDetail.map(function(d,i){\n              return(\n                <div className=\"ysp_border\">\n                  <span className=\"ysp_title\">{d.title}</span>\n                  <label className=\"ysp_content\">{d.content}</label>\n                </div>\n              )\n            })}\n            <div className=\"ysp_border\">\n              <span className=\"ysp_title\">总休假天数:</span>\n              <label className=\"ysp_content\">{data&&data.totalHoliday&&data.totalHoliday[0]}</label>\n            </div>\n            <div className=\"ysp_border\">\n              <span className=\"ysp_title\">请假原因:</span>\n              <label className=\"ysp_content\">{data.resonLeave}</label>\n            </div>\n            <div className=\"ysp_border\">\n              <span className=\"ysp_title\">附件信息:</span>\n              {data.enclosure&&data.enclosure.length&&data.enclosure.map(function(d,i){\n                return(\n                  <div className=\"ysp_hrDownload\" onClick={_this.enclosure.bind(_this)} data-i={i}>{d}</div>\n                )\n              })}\n\n            </div>\n          </div>\n          <div className=\"ysp-flowsheet\">\n            <div className=\"ysp-flowsheet-twoPart\">\n              {data&&data.table&&data.table.content.length>0&&\n                data.table.content.map(function(d,i){\n                  return(\n                    <div className=\"ysp-flowsheet-twoPart-card\">\n                      <p className=\"ysp-twoPart-cardTit\">\n                        <span>\n                          <b></b>{i+1}\n                        </span>\n                      </p>\n                      {d.map(function(dd,ii){\n                        return(\n                          <div>\n                            <span>{data.table.columnTitle[ii]}：</span>\n                            <label>{dd}</label>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  )\n                })\n              }\n            </div>\n          </div>\n        </div>\n      )\n    }else{\n      return(\n      \t<div></div>\n      )\n    }\n    \n  }\n}"
  getData: |
    if (!elem) {
      return;
    }
    if (elem) {
      var data = {
        topTitle: "",
        totalHoliday: "",
        holidayDetail: [],
        resonLeave: "",
        enclosure: [],
        table: {
          columnTitle: [],
          content: []
        }
      };

      if (elem.querySelector(".mini-panel-header")) {
        data.topTitle = elem.querySelector(".mini-panel-header").textContent.trim();
      }

      if (elem.querySelector("#holidayDays")) {
        data.totalHoliday = elem.querySelector("#holidayDays").textContent.trim().match(/\d.*/g); //请假详情
      }

      var holiday = elem.querySelector("#holidayDetail");

      if (holiday) {
        var oddTd = holiday.querySelectorAll(".form_label");
        [].forEach.call(oddTd, function (item, index) {
          var obj = {};
          obj.title = item.textContent.trim();
          obj.content = item.nextElementSibling.textContent.trim();
          data.holidayDetail.push(obj);
        });
      } //请假原因


      if (elem.querySelector("#reasonsLeave")) {
        data.resonLeave = elem.querySelector("#reasonsLeave").textContent.trim(); //附件信息
      }

      var enclosure = elem.querySelector("#enclosure");

      if (enclosure && enclosure.querySelectorAll("a").length > 0) {
        var tempArr = enclosure.querySelectorAll("a");

        for (var i = 0; i < tempArr.length; i++) {
          data.enclosure.push(tempArr[i].textContent.trim());
        }
      } //表格信息


      var table = elem.querySelector(".mini-datagrid");

      if (table) {
        var head = table.querySelectorAll(".mini-grid-headerCell");
        [].forEach.call(head, function (item, ind) {
          data.table.columnTitle.push(item.textContent);
        });
        var rowTable = table.querySelectorAll(".mini-grid-rowstable")[1];

        if (rowTable) {
          var trs = rowTable.querySelectorAll(".mini-grid-row");
          [].forEach.call(trs, function (d, i) {
            var tds = d.querySelectorAll(".mini-grid-cell");
            var tdsArr = [];
            [].forEach.call(tds, function (d, i) {
              tdsArr.push(d.textContent.trim());
            });
            data.table.content.push(tdsArr);
          });
        }
      }

      return data;
    }
  doAction: |
    if (data.eventType == "enclosure") {
      var i = data.dataCustom;
      var _btn = elem.querySelector("#enclosure").querySelectorAll("a")[i];
      var url = _btn.href;

      var _url = url.match(/putiantaili.*/); //elem.ownerDocument.defaultView.open("ftp://ftp." + _url[0]);


      elem.ownerDocument.defaultView.open(url); // if (ysp.appMain.isIOS()) {
      //   ysp.appMain.openWindow(url);
      // } else if (ysp.appMain.isAndroid()) {
      //   top.open(url);
      // var xhr = new XMLHttpRequest();
      //       top.EAPI.openWindow(url + '&_ysp_filepreview=1');
      //     } else if (ysp.appMain.isAndroid()) {
      //       top.location.href = url;
      //     }
      //   } else {
      //     elem.ownerDocument.defaultView.open(url, '404 - found');
      //   }
      // };
      // xhr.send();
    }
- name: fallBack
  getTemplate: "export default class extends React.Component{\n  change(e){\n    var handler=this.props.customHandler;\n    var e=e.target;\n     if(handler) {                                    \n       handler({\n         data:e.value,\n         eventType:'change'                         \n       })\n     }\n  }\n  onClick(e){\n    var handler=this.props.customHandler\t;\n    var e=e.target;\n     if(handler) {                                    \n       handler({\n         data:e.className,\n         eventType:'click'                         \n       })\n     }\n  }\n  render(){\n    var\tdata=this.props.customData\t|| [];\n    if(data && data.length>0){\n   \treturn(\n      <div className='ysp-fallbackStrategy'>\n      \t<div className=\"ysp-fallbackStrategy-cont\">\n          <div style={{textAlign:'center',width:'100%'}}>回退策略</div>\n        \t<div>\n          \t<span>{data[0]}</span>\n            <label>{data[1]}</label>\n          </div>\n          <div>\n          \t<span className=\"yesOrno\">{data[2]}</span>\n            {/*<textarea defaultValue={data[3]} onBlur={this.change.bind(this)}></textarea>*/}\n          </div>\n          <div>\n          \t<AMUI.Button className=\"ysp-sure\" onClick={this.onClick.bind(this)}>确定</AMUI.Button>\n            <AMUI.Button className=\"ysp-miss\" onClick={this.onClick.bind(this)}>取消</AMUI.Button>\n          </div>\n        </div>\n      </div>\n    ) }else {\n      return(<div style={{display:'none'}}></div>)\n    }\n  }\n}"
  getData: |
    if (!elem) {
      return;
    }
    if (elem) {
      var data = [];
      var signOne = elem.querySelectorAll('.form-label')[0];
      var signTwo = elem.querySelector('.mini-buttonedit-input');
      var signThree = elem.querySelectorAll('.form-label')[2]; //var signFour = elem.querySelectorAll('.mini-textbox-input')[0];

      signOne && data.push(signOne.textContent);
      signTwo && data.push(signTwo.value);
      signThree && data.push(signThree.textContent.trim()); //signFour && data.push(signFour.value);

      return data;
    }
  doAction: |
    if (data.eventType == 'change') {
      var d = data.dataCustom;
      var signFour = elem.querySelectorAll('.mini-textbox-input')[0];
      signFour.focus();
      signFour.value = d;
      signFour.dispatchEvent(new Event("change"));
    } else if (data.eventType == 'click') {
      var d = data.dataCustom;

      if (d == 'btn ysp-sure') {
        // var signOne = elem.ownerDocument.querySelectorAll('#cancel')[0];
        //   signOne.click();
        var signOne = elem.ownerDocument.querySelectorAll('#save')[0];
        signOne.click();

        var _fk = elem.ownerDocument.defaultView.parent.document.querySelector('.mini-window-drag').querySelector('iframe').contentWindow.document.querySelector('iframe').contentWindow.document.querySelector('.mini-tips-danger');

        if (_fk) {
          signOne.click();
        } else {
          var json = {
            time: new Date().getTime()
          }; // @可选的url：浏览器不会检查url是否存在，只改变url，url必须同域，不能跨域

          var btn = elem.ownerDocument.querySelector('.mini-tools-close');

          if (btn) {
            ysp.appMain.getActiveWindow().history.pushState(json, "", "/ptsoa/bps/wfclient/task/app/taskTabPage/pendingTask.jsp?");
          }
        }
      } else if (d == 'btn ysp-miss') {
        var signOne = elem.ownerDocument.querySelectorAll('#cancel')[0];
        signOne.click();
      }
    }
